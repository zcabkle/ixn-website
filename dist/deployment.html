<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <title>Deployment</title>
    <link rel="icon" type="image/x-icon" href="assets/favicon.ico" />
    <!-- Font Awesome icons (free version)-->
    <script src="https://use.fontawesome.com/releases/v5.15.4/js/all.js" crossorigin="anonymous"></script>
    <!-- Google fonts-->
    <link href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet"
        type="text/css" />
    <link
        href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800"
        rel="stylesheet" type="text/css" />
    <!-- Core theme CSS (includes Bootstrap)-->
    <link href="css/styles.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
        integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>
    <style>
        h2 {
            text-align: center;
        }

        p {
            text-align: left;
        }
        .indent-4 {
            margin-left: 5%;
        }
        .indent-8 {
            margin-left: 10%;
        }  
        .indent-12 {
            margin-left: 15%;
        }       
    </style>
    <link rel="shortcut icon" type="image/ico" href="/UCLfavicon.ico" />
</head>

<body>
    <!-- Navigation-->
    <nav class="navbar navbar-expand-lg navbar-light" id="mainNav">
        <div class="container px-4 px-lg-5">
            <a class="navbar-brand" href="index.html">IXN Team 19</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive"
                aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                Menu
                <i class="fas fa-bars"></i>
            </button>
            <div class="collapse navbar-collapse" id="navbarResponsive">
                <ul class="navbar-nav ms-auto py-4 py-lg-0">
                    <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4" href="index.html">Home</a></li>
                    <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4"
                            href="requirements.html">Requirements</a></li>
                    <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4" href="research.html">Research</a></li>
                    <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4" href="ui-design.html">UI Design</a>
                    </li>
                    <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4" href="system-design.html">System
                            Design</a></li>
                    <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4"
                            href="implementation.html">Implementation</a></li>
                    <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4" href="deployment.html">Deployment</a>
                    </li>
                    <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4" href="testing.html">Testing</a></li>
                    <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4" href="evaluation.html">Evaluation</a>
                    </li>
                    <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4" href="appendix.html">Appendix</a></li>
                </ul>
            </div>
        </div>
    </nav>
    <!-- Page Header-->
    <header class="masthead" style="background-image: url('assets/img/gradient.png')">
        <div class="container position-relative px-4 px-lg-5">
            <div class="row gx-4 gx-lg-5 justify-content-center">
                <div class="col-md-10 col-lg-8 col-xl-7">
                    <div class="page-heading">
                        <h1>Deployment</h1>
                    </div>
                </div>
            </div>
        </div>
    </header>
    <!-- Main Content-->
    <main class="mb-4">
        <!-- Start of Deployment-Intro section -->
        <section class="Deployment">
            <div class="container px-4 px-lg-5">
                <div class="row justify-content-center">
                    <div class="col-lg-10 text-center" id='background-text'>
                        <h1 class="section-title text-gradient header-underline">Deployment</h1> <br>
                        <p> This section aims to describe the process of deploying this project to the Azure cloud as 
                            a Docker container, as well as how to automate the process. The benefit of automating this
                            procedure not only saves time but allows constant feedback from the client as soon as
                            any changes are implemented. </br></br>

                            Automating deployment is not an essential part of deploying the project, 
                            but it will save a lot of time having to manually update the builds on the cloud
                            service you decide to use, and to then reinstate the running project to the updated builds
                        </p>
                        <h4 class="section-title text-gradient header-underline">Pre Requisites</h4><br>
                        <p>
                            <strong> 1. An Existing Project
                            </strong><br>
                            The Django files for the project must have existed prior to deployment, with the bare minimum 
                            of being able to run <code>python manage.py runserver</code> without it erroring. Of course you 
                            could <i>try</i> to dockerise and deploy a non functional codebase, but why would you?
                        </p>
                        <p>
                            <strong> 2. Git (and access to the repository)
                            </strong><br>
                            You may install git <a href="https://git-scm.com/downloads">here</a>. You will need git installed 
                            on the system for version control.
                            <br><br>
                            You also need a GitHub account, you can create an account from 
                            <a href="https://github.com/">GitHub</a>.  
                            You require access to the respository so that you have push/pull rights to the codebase, 
                            which is a GitHub repository.

                        </p>
                        <p>
                            <strong> 3. Azure CLI
                            </strong><br>
                            You will need the Azure Cloud Shell or some installation of the Azure CLI to complete some of 
                            the steps necessary for <i> automated deployment</i>. You can install Azure CLI 
                            <a href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli">from here</a>
                        </p>
                        <p>
                            <strong> 4. Azure Container Registry
                            </strong><br>
                            You need this registry to contain your Docker image. It will hold your Docker image in the 
                            Azure cloud, as well as all previous builds. It acts like a repository for Docker images!
                            <br><br>
                            You can create one using <a href="https://docs.microsoft.com/en-us/azure/container-registry/container-registry-get-started-portal">
                            this</a> guide. Remember what resource group is used for deployment as this is used when 
                            you automate the deployment using GitHub workflows. 
                        </p>
                        <p>
                            <strong> 5. Docker
                            </strong><br>
                            You need docker to build an image from your codebase, you can install it 
                            <a href="https://docs.docker.com/get-docker/"> here</a>
                        </p>
                        <br>
                        <h4 class="section-title text-gradient header-underline">Notice</h4><br>
                        <p>
                            <strong> Keep in mind
                            </strong><br>
                            You will need to ensure that 'Actions' is enabled for your repository.
                            You can make sure this is the case by going to <strong>Settings</strong> 
                            > <strong>Actions</strong> > <strong>Actions permissions</strong>, and select 
                            <strong>'Allow all actions'</strong>
                        </p>
                    </div>
                </div>
            </div>
        </section>
        <!-- End of Deployment-Intro section -->

        <!-- Start of Dockerizing section -->
        <section class="Dockerizing">
            <div class="container px-4 px-lg-5">
                <div class="row justify-content-center">
                    <div class="col-lg-10 text-center" id='background-text'>
                        <h1 class="section-title text-gradient header-underline">Dockerizing</h1> <br>
                        <p> Turning the project into a Docker image is not an essential part of the 
                            project, but it does offer a level of safety and encapsulation from the 
                            base system. This eliminates the cursed <i>"it works on my machine" </i>
                            fallacy.</br></br>

                            The Docker container will provide its own environment for the project to
                            run inside without the overhead of a virtual machine. <br><br>

                            This only serves as a <i>very</i> brief description of Docker. There 
                            are countless reasons for using Docker in the deployment of this 
                            project and you can read more about them <a href="https://www.docker.com/why-docker/">
                            here
                            </a>.
                        </p><br>
                        <h4 class="section-title text-gradient header-underline">Setting up Docker</h4><br>
                        <p>
                            <strong>Setup
                            </strong><br>
                            Before being able to create a Docker container for your project, 
                            you will need to have Docker installed locally. </br></br>

                            Please choose the correct installation guide for your machine from
                            <a href="https://docs.docker.com/get-docker/"> here</a>.
                        </p><br>
                        <h4 class="section-title text-gradient header-underline">Making the Dockerfile</h4><br>
                        <p>
                            <strong>Here's the Dockerfile
                            </strong><br>
                            Here's the Dockerfile that you can use to setup the container... </br></br>

                            Docker will use this file as guidance on how to build a container for our 
                            project. We need to place it at the root of the project directory, with the 
                            name <code>Dockerfile</code>. <br><br>
                            <samp>ucl-ixn-team19/</samp><br>
                            <samp class="indent-4">.gitignore</samp><br>
                            <code class="indent-4">Dockerfile</code><br>
                            <samp class="indent-4">README.md</samp><br>
                            <samp class="indent-4">requirements.txt</samp><br>
                            <samp class="indent-4">myvenv/</samp><br>
                            <samp class="indent-8">manage.py</samp><br>
                            <samp class="indent-8">lib/..</samp><br>
                            <samp class="indent-8">bin/..</samp><br>
                            <samp class="indent-8">mysite/</samp><br>
                            <samp class="indent-12">__init__.py</samp><br>
                            <samp class="indent-12">settings.py</samp><br>
                            <samp class="indent-12">urls.py</samp><br>
                            <samp class="indent-12">wsgi.py</samp><br>
                            <samp class="indent-8">website/</samp><br>
                            <samp class="indent-12">__init__.py</samp><br>
                            <samp class="indent-12">admin.py</samp><br>
                            <samp class="indent-12">apps.py</samp><br>
                            <samp class="indent-12">constants.py</samp><br>
                            <samp class="indent-12">forms.py</samp><br>
                            <samp class="indent-12">template_filter.py</samp><br>
                            <samp class="indent-12">urls.py</samp><br>
                            <samp class="indent-12">migrations/..</samp><br>
                            <samp class="indent-12">templates/..</samp><br>
                            <samp class="indent-12">tests/..</samp><br>

                        </p>
                        <p>
                            <strong>Contents of the Dockerfile:
                            </strong><br>

                            <samp><code>FROM</code> python:3.8.3-alpine</samp><br><br>
                                <samp># set work directory<samp><br>
                                
                                <samp><code>WORKDIR</code> /usr/src/app</samp><br><br>
                                
                                <samp># set environment variables</samp><br>
                                <samp><code>ENV</code> PYTHONDONTWRITEBYTECODE 1</samp><br>
                                <samp><code>ENV</code> PYTHONUNBUFFERED 1</samp><br><br>
                                
                                <samp># copy project</samp><br>
                                <samp><code>COPY</code> . /usr/src/app</samp><br><br>
                                
                                <samp># install dependencies</samp><br>
                                <samp><code>RUN</code> python -m pip install -r requirements.txt</samp><br>
                                
                                <samp><code>EXPOSE</code> 8000</samp><br><br>

                                <samp># commands issued to container</samp><br>

                                <samp><code>RUN</code> python myvenv/manage.py clearsessions</samp><br>
                                <samp><code>RUN</code> python myvenv/manage.py makemigrations</samp><br>
                                <samp><code>RUN</code> python myvenv/manage.py migrate</samp><br>
                                <samp><code>CMD</code> ["python", "myvenv/manage.py", "runserver", "0.0.0.0:8000"]</samp><br>
                        </p>
                        <p>
                            <strong>What does any of this mean?...
                            </strong><br>
                            Each of the lines in the <code>Dockerfile</code> is called a directive <br><br>

                            <samp><code>FROM</code> python:3.8.3-alpine </samp>
                            tells Docker which base image to build our container on. <br><br>

                            <samp><code>WORKDIR</code> /usr/src/app </samp>
                            sets the working directory, and all following directives are executed here.<br><br>
                            
                            <samp><code>ENV</code> PYTHONUNBUFFERED 1</samp> will
                            tell Docker to send Python output to the terminal instead of buffering it
                            in the standard output buffer app<br><br>

                            <samp><code>RUN</code> python -m pip install -r requirements.txt</samp>
                            installs all dependencies from <samp>requirements.txt</samp><br><br>

                            <strong>Further...</strong><br>
                            <samp><code>RUN</code> python myvenv/manage.py clearsessions</samp><br>
                            <samp><code>RUN</code> python myvenv/manage.py makemigrations</samp><br>
                            <samp><code>RUN</code> python myvenv/manage.py migrate</samp><br><br>
                            Are all run in order to prepare the Django project to be used and prevent 
                            any errors due to changes in the codebase 
                        </p>

                        <h4 class="section-title text-gradient header-underline">Running the project as a container</h4><br>
                        <p>
                            <strong>Building the Docker image
                            </strong><br>
                            Use this command, <i>from the root of the project directory</i>, in order to build an
                             image from the project files<br><br>
                            <samp><code>docker</code> build . -t &lt;image-name&gt;:latest</samp><br>
                            See documentation <a href="https://docs.docker.com/engine/reference/commandline/build/">
                            here</a>, remember to replace <code>&lt;image-name&gt;</code><br><br>

                            <code>-t</code> sets the tag for the image to <samp>latest</samp><br><br>
                        </p>
                        <p>
                            <strong>Running the Docker image
                            </strong><br>
                            Use this command in order to run a container based on the image we created<br><br>
                            <samp><code>docker</code> run --name &lt;image-name&gt; -d -p 8000:8000 &lt;image-name&gt;:latest
                            </samp><br>
                            See documentation <a href="https://docs.docker.com/engine/reference/commandline/run/">
                            here</a>
                            <br><br>

                            <code>-name</code> selects the name of the Docker container<br>
                            <code>-d</code> makes the image run in detached mode, i.e. the background<br>
                            <code>-p 8000:8000</code> maps port 8000 from the container to port 8000 of 
                            <samp>localhost</samp><br><br>

                            Now go to <samp>localhost:8000</samp> in your browser where the application
                            is running!<br><br>
                        </p>

                        <p>
                            <strong>Congratulations!!</strong><br>
                            You have sucessfully set configured the application to run its own isolated 
                            Docker container! 
                        </p>

                        <p>
                            <strong>Killing the container
                            </strong><br>
                            In order to pause the application, <i>remember that it was running
                            in the background</i>, we issue the following command.<br><br>


                            <samp><code>docker</code> ps</samp><br>
                            In order to list all running containers, see documentation 
                            <a href="https://docs.docker.com/engine/reference/commandline/ps/"> here</a>.<br><br>
                            
                            This would produce something like...<br>
                            <pre><samp>CONTAINER ID   IMAGE            COMMAND                  CREATED         STATUS         PORTS                    NAMES<br>841d06f865bc   testing:latest   "python myvenv/manag…"   9 minutes ago   Up 9 minutes   0.0.0.0:8000->8000/tcp   testing
                            </samp></pre>
                            
                        </p>
                        <p>
                            Remember to select the <samp>CONTAINER ID</samp>, in this case <code>841d06f865bc</code>. <br><br>

                            And then issue:<br>
                            <samp><code>docker</code> kill &lt;container-id&gt; </samp><br>
                            In order to stop <i>that</i> running container, see documentation 
                            <a href="https://docs.docker.com/engine/reference/commandline/kill/"> here</a>.<br>
                        </p>
                        
                    </div>
                </div>
            </div>
        </section>
        <!-- End of Dockerizing section -->
        <!-- Start of Deployment-Azure section -->
        <section class="Deployment-Azure">
            <div class="container px-4 px-lg-5">
                <div class="row justify-content-center">
                    <div class="col-lg-10 text-center" id='background-text'>
                        <h1 class="section-title text-gradient header-underline">Deploying to Azure</h1> <br>
                        <p>
                            This guide will describe the process of deploying the application
                            to Azure using github actions. We have chosen to deploy the application
                            to Azure, however a Docker container is portable and may be run at 
                            any endpoint! <i>So feel free to deploy anywhere you see fit!</i><br><br>
                            
                            Likewise keep in mind that we have already looked at how to run the 
                            project as a container locally, so there is nothing to stop you form
                            running it on premises!<br>
                        </p>

                        <h4 class="section-title text-gradient header-underline">Notice</h4><br>
                        <p>
                            <strong> Keep in mind
                            </strong><br>
                            You will have to adjust the endpoint permissions for the application...<br><br>

                            This involves adjusting the allowed hosts in <samp>myvenv/mysite/settings.py</samp>
                            and also changing the final directive in the <samp>Dockerfile</samp><br><br>

                            <strong> <samp>settings.py</samp>    
                            </strong><br>

                            <samp>
                                ALLOWED_HOSTS = ['127.0.0.1', 'localhost']<br><br>
                            </samp>
                            Would become<br>
                            <samp>
                                ALLOWED_HOSTS = ['127.0.0.1', 'localhost', <i>'your-endpoint-ip'</i>]
                            </samp><br><br>
                            
                            <strong> <samp>Dockerfile</samp>    
                            </strong><br>

                            <samp>...<br><code>CMD</code> ["python", "myvenv/manage.py", "runserver", "0.0.0.0:8000"]</samp><br><br>

                            Would change to<br>
                            <samp>...<br><code>CMD</code> ["python", "myvenv/manage.py", "runserver", <i>"your-endpoint-ip:port"</i>]</samp><br><br>

                        </p>
                    </div>
                </div>
            </div>
        </section>
        <!-- End of Deployment-Azure section -->
    </main>
    <!-- Footer-->
    <footer class="border-top">
        <div class="container px-4 px-lg-5">
            <div class="row gx-4 gx-lg-5 justify-content-center">
                <div class="col-md-10 col-lg-8 col-xl-7">
                    <ul class="list-inline text-center">
                        <li class="list-inline-item">
                            <a href="https://twitter.com/uclcs?ref_src=twsrc%5Egoogle%7Ctwcamp%5Eserp%7Ctwgr%5Eauthor">
                                <span class="fa-stack fa-lg">
                                    <i class="fas fa-circle fa-stack-2x"></i>
                                    <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                        <li class="list-inline-item">
                            <a href="https://www.facebook.com/UCLCS.Home/">
                                <span class="fa-stack fa-lg">
                                    <i class="fas fa-circle fa-stack-2x"></i>
                                    <i class="fab fa-facebook-f fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                        <li class="list-inline-item">
                            <a href="https://github.com/ArslanAftab/ucl-ixn-team19">
                                <span class="fa-stack fa-lg">
                                    <i class="fas fa-circle fa-stack-2x"></i>
                                    <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                    </ul>
                    <div class="small text-center text-muted fst-italic">
                        <p>Copyright © 2021 - 2022
                            <a href="https://www.moorfields.nhs.uk/">Moorfields Hospital</a>
                            ,
                            <a href="https://www.arslemon.com">Arslan Aftab</a>
                            ,
                            <a href="!#">Yue He</a>
                            ,
                            <a href="https://www.linkedin.com/in/kamil-ebanks/">Kamil Ebanks</a>
                            - All rights reserved.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </footer>
    <!-- Bootstrap core JS-->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Core theme JS-->
    <script src="js/scripts.js"></script>
    <!-- * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *-->
    <!-- * *                               SB Forms JS                               * *-->
    <!-- * * Activate your form at https://startbootstrap.com/solution/contact-forms * *-->
    <!-- * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *-->
    <script src="https://cdn.startbootstrap.com/sb-forms-latest.js"></script>
</body>

</html>