<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <title>Implementation</title>
    <link rel="icon" type="image/x-icon" href="assets/favicon.ico" />
    <!-- Font Awesome icons (free version)-->
    <script src="https://use.fontawesome.com/releases/v5.15.4/js/all.js" crossorigin="anonymous"></script>
    <!-- Google fonts-->
    <link href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet"
        type="text/css" />
    <link
        href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800"
        rel="stylesheet" type="text/css" />
    <!-- Core theme CSS (includes Bootstrap)-->
    <link href="css/styles.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
        integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>
    <style>
        h2 {
            text-align: center;
        }

        p {
            text-align: left;
        }
    </style>
</head>

<body>
    <!-- Navigation-->
    <nav class="navbar navbar-expand-lg navbar-light" id="mainNav">
        <div class="container px-4 px-lg-5">
            <a class="navbar-brand" href="index.html">IXN Team 19</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive"
                aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                Menu
                <i class="fas fa-bars"></i>
            </button>
            <div class="collapse navbar-collapse" id="navbarResponsive">
                <ul class="navbar-nav ms-auto py-4 py-lg-0">
                    <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4" href="index.html">Home</a></li>
                    <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4"
                            href="requirements.html">Requirements</a></li>
                    <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4" href="research.html">Research</a></li>
                    <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4" href="ui-design.html">UI Design</a>
                    </li>
                    <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4" href="system-design.html">System
                            Design</a></li>
                    <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4"
                            href="implementation.html">Implementation</a></li>
                    <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4" href="deployment.html">Deployment</a>
                    </li>
                    <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4" href="testing.html">Testing</a></li>
                    <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4" href="evaluation.html">Evaluation</a>
                    </li>
                    <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4" href="appendix.html">Appendix</a></li>
                </ul>
            </div>
        </div>
    </nav>
    <!-- Page Header-->
    <header class="masthead" style="background-image: url('assets/img/gradient.png')">
        <div class="container position-relative px-4 px-lg-5">
            <div class="row gx-4 gx-lg-5 justify-content-center">
                <div class="col-md-10 col-lg-8 col-xl-7">
                    <div class="page-heading">
                        <h1>Implementation</h1>
                    </div>
                </div>
            </div>
        </div>
    </header>
    <!-- Main Content-->
    <main class="mb-4">

        <section>
            <div class="container px-4 px-lg-5">
                <div class="row justify-content-center">
                    <div class="col text-center">
                        <h1 class="section-title text-gradient header-underline">Main Tools</h1>
                        <br><br>
                        <div class="card-deck">
                            <div class="card border-secondary mb-3">
                                <div class='text-center'>
                                    <br>
                                    <img class="card-img-top" src="assets/img/pythonlogo.png" alt="Card image cap"
                                        style="width: 100px; height: 100px;">
                                </div>
                                <div class="card-body">
                                    <p class="card-text">Python was the language that we used for the backend to program
                                        the flow of data through the model, view and the template.</p>
                                </div>
                            </div>

                            <div class="card border-secondary mb-3">
                                <div class='text-center'>
                                    <br>
                                    <img class="card-img-top" src="assets/img/djangologo.png" alt="Card image cap"
                                        style="width: 221px; height: 100px;">
                                </div>
                                <div class="card-body">
                                    <p class="card-text"> Django framework was the main tool to implement the webapp.
                                        We used its built in methods to implement our application including the
                                        authentication system
                                        and admin site.

                                    </p>
                                </div>
                            </div>
                            <div class="card border-secondary mb-3">
                                <div class='text-center'>
                                    <br>
                                    <img class="card-img-top" src="assets/img/bootstrap.png" alt="Card image cap"
                                        style="width: 126px; height: 100px;">
                                </div>
                                <div class="card-body">
                                    <p class="card-text">Bootstrap is a CSS framework containing HTML and CSS base
                                        design
                                        templates.
                                        It was used for our front-end development.
                                    </p>
                                </div>
                            </div>
                            <div class="card border-secondary mb-3">
                                <div class='text-center'>
                                    <br>
                                    <img class="card-img-top" src="assets/img/SQLite.png" alt="Card image cap"
                                        style="width: 211px; height: 100px;">
                                </div>
                                <div class="card-body">
                                    <p class="card-text">SQLite is used as for our embedded database.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <br><br>
        </section>

        <section>
            <div class="container px-4 px-lg-5">
                <div class="row justify-content-center">
                    <div class="col-lg-10 text-center">
                        <h1 class="section-title text-gradient header-underline">Implementation Overview</h1><br>
                        <section>
                            <h3 class="section-title text-gradient">Authentication</h3><br>
                            <p>
                                In Django, <code>LoginRequiredMixin</code> is an inheritance class that only allows
                                requests
                                to
                                a view
                                class from logged-in users. In this class, any unauthorised user will be redirected to
                                the
                                log-in page.
                                We implemented a view class called 'UserView' which inherits
                                <code>LoginRequiredMixin</code>. All other
                                view
                                classes extend 'UserView', therefore, all successful HTTP requests to our application
                                require the user to be logged in.<br>

                            <pre class="text-left"><code class="language-python">
                                    class UserView(LoginRequiredMixin, View):
                                    '''A base class for the rest of the views
                                        to extend and utilise, automatically fetches
                                        username and firstname for logged in user
                                        N.B. restrict what is returned to the webpage'''
                                
                                    username = None
                                    first_name = None
                                
                                    def fetch_details(self, request):
                                        self.first_name = request.user.get_short_name()
                                        self.username = request.user.username
                                    
                                </code></pre>
                            </p>
                        </section>
                        <br>

                        <section>
                            <h3 class="section-title text-gradient">Admin Responsibilities</h3><br>
                            <p>
                                Django's built-in admin site allows admins to manage users as well as user groups and
                                permissions.<br><br>

                                At admin.py, <code>admin.site.register(model)</code> functions are used to register data
                                models to the admin site so that these models can easily be created, destroyed and
                                modified
                                through the user interface.<br>

                            </p>
                            <img class="img" style="height:400px" alight="right" src="assets/img/admin_1.png"
                                alt="Card image cap">
                        </section>

                        <br><br>

                        <section>
                            <h3 class="section-title text-gradient">Database Connection</h3><br>
                            <p> We used SQLite as our database.
                                Django has a built-in ORM system which means database tables are directly mapped to
                                model
                                classes. Each instance of one of these classes represents a particular record in the
                                database.<br><br>

                                In settings.py there exists a dictionary that contains the settings for the databases
                                that
                                would be used in the web app.
                                NAME specifies the name of the database and ENGINE specifies the type of database.
                            </p>

                            <pre class="text-left"><code class="language-python">
                                DATABASES = {
                                    'default': {
                                        'ENGINE': 'django.db.backends.sqlite3',
                                        'NAME': os.path.join(BASE_DIR, 'db.sqlite3'),
                                    }
                                }
                            </code></pre>

                            <p>If connecting to another type of database, other parameters may be required, such as
                                username,
                                password and host.</p>
                            <br>
                        </section>
                        <br>
                        <section>
                            <h4 class="section-title text-gradient">Display Daily Rota</h4><br>
                            <p> This section describes how we show a user's daily timetable on the "My Rota" page. It is
                                necessary
                                to understand this process as generating weekly rota and team rota are variations of
                                this
                                process.
                            </p>
                            <strong>1. Identify logged in user</strong><br>
                            <p>
                                The <code>UserView</code> class has a <code>fetch_details(self, request)</code> function
                                which
                                automatically fetches username and firstname for logged in users.
                                It is a base class and is extended by RotaView.
                                At RotaView, the user object can be identified by
                                the fetched username.
                            </p>
                            <strong>2. Identify the required date</strong><br>
                            <p>
                                A datetime picker is imported from "bootstrap_datepicker_plus.widgets". It works
                                alongside jquery and Django forms to provide the functionality
                                to select a particular date on a GUI.
                                When the user sends a valid form, either by entering the date manually or clicking on
                                the
                                graphical calendar, it is sent to RotaView in the request.
                                We use the variable <code>selected_date</code> (set to the current date if no user
                                input)
                                to store user input.
                            </p>
                            <strong>3. Generate rota </strong>
                            <p> We nearly have all of the information to generate the rota (the user and the date).

                                Now we get all non-cancelled appointments with this user on selected_date and order them
                                by
                                start time with
                                these lines of code.
                                As seen below we make use of Django's built-in .filter() and .exclude() functions.
                            </p>
                            <pre class="text-left"><code class="language-python">
                                    def generate_rota_appointments_ordered(self, selected_date, user):
                                        cancelled = AppointmentStatus.objects.all().filter(
                                            status='Cancelled')[0]
                                        rota_appointments_ordered = list(Appointment.objects.all().filter(
                                            appointment_date=selected_date, team_member=user).exclude(
                                                appointment_status=cancelled))
                                        rota_appointments_ordered.sort(
                                            key=lambda x: (x.appointment_start_time))

                                        return rota_appointments_ordered
                            </code></pre>
                            <p>
                                Then the <code>generate_day_rota(self, appointments, tmp_rota)</code> function is
                                called
                                to assign each appointment to its time slots. This is done by looking at the start time
                                of
                                each appointment and the appointment type, which determines the number of slots taken
                                up.
                                Each appointment is filled into its timeslots on tmp_rota, which is an empty dictionary
                                with
                                time
                                slots as keys and
                                appointment objects as values.
                                tmp_rota is a duplicate of DAY_ROTA which can be found in constants.py.
                                The view class then renders the template and returns this rota in the response.
                            </p>
                            <pre class="text-left"><code class="language-python">
                                def generate_day_rota(self, appointments, tmp_rota):
                                    for appointment in appointments:
                                        appointment_code = (
                                            appointment.appointment_code.appointment_description)
                                        appointment_length = SLOTS[appointment_code]
                                        start_time = str(appointment.appointment_start_time)[:5]
                                        start_index = DAY_ROTA_KEYS.index(start_time)

                                        for i in range(start_index, start_index + appointment_length):
                                            key = DAY_ROTA_KEYS[i]
                                            tmp_rota[key] = appointment

                                    return tmp_rota
                            </code></pre>
                            <strong>4. Display</strong>
                            <p>
                                The template receives the rota from the view class. Using a loop and a table we display
                                the
                                rota graphically. Looping through the dictionary creates the rows in the table.
                                If statements are used to determine how the row should look, depending on whether
                                the dictionary
                                value is populated or empty; the different row colours are implemented using Bootstrap.
                                'Add New Appointment' button is implemented using Bootstrap, it is embedded with a
                                link
                                and clicking the button will
                                take the user to a form.
                                The patient name and appointment ID are displayed on the table, they are embedded with a
                                link to another
                                template which shows the user more details.
                            </p>
                            <img class="img" style="height:400px" alight="right" src="assets/img/myrotaview.png"
                                alt="Card image cap">
                            <br><br>
                        </section>
                        <br><br>
                        <section>
                            <h4 class="section-title text-gradient">Display Weekly Rota</h4><br>
                            <p> This process is nearly identical to displaying a daily rota as above.</p>
                            <strong>1. Identify logged in user</strong><br>
                            <p>
                                Same case as 'Daily Rota'.
                            </p>
                            <br>
                            <strong>2. Identify required dates</strong><br>

                            <p>
                                As above, the user selects a date manually or through the GUI.
                                We generate an array of 7 consecutive days from this date, this is the week we will
                                display.
                                It is stored under <strong>VARIABLE</strong>.
                            </p>
                            <pre class="text-left"><code class="language-python">
                                dates = [str(selected_date + timedelta(days=x)) for x in range(0, 8)]</code></pre>
                            <br>

                            <strong>3. Generate rotas</strong><br>
                            <p> Step 3 is very similar to 'Daily Rota', instead, we call
                                <code>generate_day_rota()</code> for
                                each
                                date
                                and store these rotas in an array.
                                The view passes this array to the template in the response.
                            </p>

                            <strong>4. Display</strong><br>
                            <p> Step 4 is very similar to 'Daily Rota'. We loop through the array of rotas and display
                                each one
                                side by side. We display each rota in an identical fashion as 'Daily Rota'.
                            </p>
                        </section>
                        <br><br>
                        <section>
                            <h4 class="section-title text-gradient">Display Patient List</h4>
                            <br>
                            <strong>1. Fetch data</strong>
                            <p> In <code>WaitingListView</code> class, patients are separated into
                                <code>bookedPatients</code>
                                and <code>waitingPatients</code>. These queries are passed to the response by the view.
                            </p>

                            <pre class="text-left"><code class="language-python">
                                bookedPatients = Patient.objects.all().filter(patient_status=booked)
                                waitingPatients = Patient.objects.all().exclude(patient_status=booked)
                                </code></pre>
                            <br>
                            <strong>2. Display </strong>
                            <p> Bootstrap cards are used as content containers in our HTML templates.
                                We used for loops to generate a card and to dynamically fill in a patient's data to that
                                card.
                            </p>
                        </section>
                        <br><br>
                        <section>
                            <h4 class="section-title text-gradient">Display Appointment List</h4><br>
                            <strong>1. Fetch data</strong>
                            <p>In <code>AppointmentView</code> class, appointments are separated
                                into past, upcoming and cancelled. This is done so through a simple for loop.
                                We take all non-cancelled appointments and loop through them. For each appointment, if
                                appointment_date is before today it goes to an array storing past appointments
                                otherwise it does to an array storing future appointments.

                            <pre class="text-left"><code class="language-python">
                                    temporaryAppointments = Appointment.objects.all().exclude(
                                        appointment_status=cancelled)
                                    appointments = []
                                    past = []
                                    for appointment in temporaryAppointments:
                                        if appointment.appointment_date < today:
                                            past.append(appointment)
                                        else:
                                            appointments.append(appointment)
                                    </code></pre>

                            <p>Cancelled appointments are collected with a query.</p>

                            <pre class="text-left"><code class="language-python">
                            cancelledAppointments = Appointment.objects.all().filter(
                                appointment_status=cancelled)
                            </code></pre>
                            <p>These queries and arrays are passed to the response by the view.</p>

                            <strong>2. Display</strong>
                            <p> Bootstrap cards are used as content containers for our HTML templates.
                                For each array/query given to the template, we do a separate loop.
                                The loops generates a card and dynamically fills in an appointment's data to that card.
                                The loop will also add buttons, such as cancel and update, to the card if necessary.
                            </p>
                        </section>

                        <section>
                            <h4 class="section-title text-gradient">PAS Checklist</h4><br>
                            <p> The PAS checklist is handled by the <code>ChecklistView</code> class, appointments that haven't been confirmed on PAS
                                are displayed. Once an admin staff has input changes into PAS, they can tick of the
                                appointment from the checklist page. This section will explain how this functionality is
                                implemented.</p><br>
                                <strong>Fetch Appointments</strong>
                                <p> In ChecklistView appointments that aren't confirmed on PAS are retrieved from the database and returned in the response to the template.

                            <pre class="text-left"><code class="language-python">
                            def get(self, request):
                                super().fetch_details(request)
                                appointmentsn = Appointment.objects.filter(
                                    status_confirmed_on_pas='n')
                                appointmentsN = Appointment.objects.filter(
                                    status_confirmed_on_pas='N')
                        
                                appointments = appointmentsn | appointmentsN
                                return render(request, 'website/checklist.html',
                                                {'appointments': appointments,
                                                'first_name': self.first_name})
                        
                            </code></pre>

                            <p> These appointments are displayed with a Bootstrap card in a very similar fashion to how patients are displayed on the patients page, and appointments on the appointments page.
                                Each appointment has a button to tick it off.
                            </p>
                            <strong>Tick Appointments</strong>
                            <p> When a user clicks the button to tick the appointment the following actions are taken: <br>
                                1. User is taken to /tick_appointment/pk.<br><br>
                                2. urls.py sends to user to TickAppointmentView.py.<br><br>
                                3. TickAppointmentView sets status_confirmed_on_pas to 'Y' and removes the comments about the changes.<br><br>
                                4. User gets redirected to checklist.<br><br>

                                This appointment will no longer appear on the checklist as its status_confirmed_on_pas is 'Y' and not 'N' or 'n'
                            </p>
                        </section>

                        <section>
                            <h4 class="section-title text-gradient">Update Patient</h4><br>
                            <p>This section describes how updating a patient works. Updating an appointment is very
                                similar to this process.</p>
                            <strong> Model Forms </strong>
                            <p>
                                It is necessary to understand how the Django <code>ModelForm</code> class works in order
                                to understand this section along
                                with Add Patient, Update Appointment and Update Patient.<br><br>
                                This class creates a form from a Django model.
                                These forms are defined in forms.py, each attribute in the model is given a field to
                                enter information.
                            </p>
                            <pre class="text-left"><code class="language-python">
                                    class PatientForm(ModelForm):
                                        class Meta:
                                            model = Patient
                                            fields = ('PAS_number', 'first_name', 'middle_name',
                                                    'surname', 'DOB', 'priority_code',
                                                    'patient_information', 'patient_status')

                                            widgets = {
                                                'PAS_number': forms.NumberInput(
                                                    attrs={'class': 'form-control'})
                                                    ...
                                            }
                                </code></pre>

                            <strong> is_valid() </strong>
                            <p> It is also necessary to understand how <code>.is_valid()</code> works to
                                understand this section along
                                with Add Patient, Update Appointment and Update Patient.<br><br>

                                By default, this function checks the data input into the fields. If and only if there is
                                a violation regarding the type of data input to the field, then is_valid returns false.
                                For example, using the code snippet above, if <code>'hello'</code> is input to the
                                <code>PAS_number</code> field then <code>is_valid()</code> will return false.
                                However, if <code>123</code> was input to the field, then <code>is_valid</code> would
                                return true.
                            </p>

                            <strong> Get Method </strong>
                            <p>If the user is getting the update patient page, the functionality works as
                                follows:<br><br>
                                1. User clicks update patient button which brings them to the URL,
                                /update_patient/pk.<br>
                                2. urls.py sends the user to UpdatePatientView.<br>
                                3. UpdatePatientView uses this pk to fetch the patient object with this primary
                                key.<br>
                                4. UpdatePatientView creates a PatientForm for a patient and fills in the form with the
                                patient's information.<br>
                                5. UpdatePatientView renders this form in the template.<br>
                            </p>
                            <pre class="text-left"><code class="language-python">
                                class UpdatePatientView(UserView):
                                    def get(self, request, patient_id):
                                        super().fetch_details(request)
                                        patient = Patient.objects.get(pk=patient_id)
                                        form = PatientForm(request.POST or None, instance=patient)
                                        return render(request, 'website/update_patient.html',
                                                    {'patient': patient, 'form': form,
                                                    'first_name': self.first_name})

                                </code></pre>



                            <strong> Post Method </strong>
                            <p> If the user is posting to the update patient page the functionality works as
                                follows.<br><br>
                                1. UpdatePatientView receives the form and checks if it is valid using
                                <code>.is_valid()</code><br>
                                2. If it is valid then the form is saved to the database and the user gets
                                redirected<br>
                                3. Else, the user cant submit the form and an error message will explain what is wrong
                                with the form.<br>

                            <pre class="text-left"><code class="language-python">
                                    class UpdatePatientView(UserView):
                                        ...

                                        def post(self, request, patient_id):
                                            super().fetch_details(request)
                                            patient = Patient.objects.get(pk=patient_id)
                                            form = PatientForm(request.POST or None, instance=patient)
                                            if form.is_valid():
                                                form.save()
                                                return redirect('/wait_list')
                                            return render(request, 'website/update_patient.html',
                                                        {'patient': patient, 'form': form,
                                                        'first_name': self.first_name})
    
                                    </code></pre>


                        </section>

                        <section>
                            <h4 class="section-title text-gradient">Update Appointment</h4><br>
                            <p>This section describes how updating an appointment works. Updating an appointment is very
                                similar to updating a patient. Please fully read 'Update Patient' before reading this
                                section.</p>
                            <strong> Clean Functions </strong>
                            <p>
                                It is necessary to understand how the clean functions work
                                to understand this section along
                                with 'Add Appointment'.<br><br>
                                Clean functions are used by <code>.is_valid()</code> to check the data. If a clean
                                function isn't defined, for example in a patient form, then <code>.is_valid()</code>
                                works as described in Update Patient. However, when we are updating appointments we want
                                to check for appointment clashes so we define a clean function that performs the checks
                                that are performed by the default
                                <code>is_valid()</code> function and also checks for appointment clashes. <br><br>

                                This function raises validation errors if there are any problems with the inputs.
                                These validation errors will be displayed to the user if they cant submit
                                the form. <br><br>

                                *This code snippet is quite large, but it can be found in forms.py
                            </p>

                            <strong> Get Method </strong>
                            <p> If the user is getting the update appointment page, the functionality works as
                                follows:<br><br>
                                1. User clicks update appointment button which brings them to the URL,
                                /update_appointment/pk.<br>
                                2. urls.py sends the user to UpdateAppointmenttView.<br>
                                3. UpdateAppointmentView uses this pk to fetch the appointment object with this primary
                                key.<br>
                                4. UpdateAppointmentView creates an AppointmentForm for an appointment and fills in the
                                form with the
                                appointment's information.<br>
                                5. UpdateAppointmentView renders this form in the template.<br><br>

                                *This works identically to updating a patient
                            </p>

                            <strong> Post Method </strong>
                            <p> If the user is posting to the update appointment page the functionality works as
                                follows.<br><br>
                                1. UpdateAppointmentView receives the form and checks if it is valid using
                                <code>.is_valid()</code>, this <code>is_valid()</code> function uses the clean function
                                that we defined. So it also checks for appointment clashes.<br>
                                2. If it is valid then the end time is calculated, the form is saved to the database and
                                the user gets
                                redirected<br>
                                3. Else, the user cant submit the form and an error message will explain what is wrong
                                with the form.<br>
                            </p>

                            <pre class="text-left"><code class="language-python">
                                def post(self, request, appointment_id):
                                super().fetch_details(request)
                                appointment = Appointment.objects.get(appointment_ID=appointment_id)
                                form = AppointmentForm(request.POST or None, instance=appointment)
                        
                                if form.is_valid():
                                    start_time = form.cleaned_data['appointment_start_time']
                                    appointment_code_obj = form.cleaned_data['appointment_code']
                                    appointment_type = appointment_code_obj.appointment_description
                                    timing = APPOINTMENT_TIMING[appointment_type]
                                    end_time = datetime.combine(date.today(), start_time) + timing
                        
                                    form.instance.appointment_end_time = end_time
                                    form.instance.status_confirmed_on_pas = 'N'
                                    form.save()
                        
                                    return HttpResponseRedirect('/appointments')
                                return render(request, 'website/update_appointment.html',
                                              {'appointment': appointment, 'form': form,
                                               'first_name': self.first_name})
                                    </code></pre>


                        </section>

                        <section>
                            <h4 class="section-title text-gradient">Add Patient</h4><br>
                            <p>This section describes how adding a patient works. Updating a patient is very similar to
                                this process, please read 'Update Patient' before reading this section.</p>

                            <strong> Get Method </strong>
                            <p>If the user is getting the update patient page, the functionality works as
                                follows:<br><br>
                                1. User clicks update patient button which brings them to the URL,
                                /add_patient<br>
                                2. urls.py sends the user to AddPatientView.<br>
                                3. AddPatientView creates an empty PatientForm.<br>
                                4. UpdatePatientView renders this form in the template.<br>
                            </p>

                            <strong> Post Method </strong>
                            <p> If the user is posting to the add patient page the functionality works as
                                follows.<br><br>
                                1. AddPatientView recieves the form and checks if it is vaild using
                                <code>.is_valid()</code>. <code>.is_valid()</code> works as described in 'Update
                                Patient'.<br>
                                2. If it is valid then the form is saved to the database and the user gets
                                redirected<br>
                                3. Else, the user cant submit the form and an error message will explain what is wrong
                                with the form.<br>

                        </section>

                        <section>
                            <h4 class="section-title text-gradient">Add Appointment</h4><br>
                            <p>This section describes how adding an appointment works. Updating an appointment is very
                                similar to
                                this process, please read 'Update Appointment' before reading this section.</p>

                            <strong> Get Method </strong>
                            <p> If the user is getting the add appointment page, the functionality works as
                                follows:<br><br>
                                1. User clicks add appointment button which brings them to the URL,
                                /add_appointment.<br>
                                2. urls.py sends the user to AddAppointmenttView.<br>
                                3. AddAppointmentView creates an empty AppointmentForm.<br>
                                4. AddAppointmentView renders this form in the template.<br><br>

                                *This works identically to adding a patient
                            </p>

                            <strong> Post Method </strong>
                            <p> If the user is posting to the add appointment page the functionality works as
                                follows.<br><br>
                                1. AddAppointmentView receives the form and checks if it is valid using
                                <code>.is_valid()</code>, this <code>is_valid()</code> function uses the clean function
                                that we defined. So it also checks for appointment clashes.
                                Read about the clean method in 'Update Appointment'<br>
                                2. If it is valid then the end time is calculated, the form is saved to the database and
                                the user gets
                                redirected<br>
                                3. Else, the user cant submit the form and an error message will explain what is wrong
                                with the form.<br>

                        </section>
                        <section>
                            <h4 class="section-title text-gradient">Delete Patient</h4><br>
                            <p>Deleting a patient is handled by DeletePatientView.py</p>
                            <strong>1. Delete a patient if they exist.</strong>
                            <p> This functionality is accessed by the URL /delete_patient/pk. To check that a patient
                                with this pk exists we try to query a patient with this pk. If an error is thrown then
                                they don't exist. If an error is not thrown then they exist and we delete the patient.
                            </p>

                            <strong>2. Generate message.</strong>
                            <p>
                                We also create a message for the user to be displayed in the green panel on our
                                interface.
                            </p>

                            <strong>3. Display.</strong>
                            <p>
                                The view renders the patients page and displays all of the patients that still exist on
                                the database. The message is also rendered in the notification panel.
                            </p>
                        </section>

                        <section>
                            <h4 class="section-title text-gradient">Cancel Appointment</h4>
                            <p> Cancelling appointments uses CancelAppointmentView.py and this file will be referred to
                                throughout this section. </p>
                            <strong> Get Method </strong>
                            <p>
                                Cancel appointment functionality works as follows:<br><br>

                                1. User accesses cancel_appointment/pk then urls.py sends the user to
                                CancelAppointmentView.py.<br>
                                2. If it is less than 2 days before the appointment, a message is added to the
                                appointment which can be viewed on the PAS checklist.<br>
                                3. Appointment status is set to 'Cancelled' and status_confirmed_on_pas is set to
                                'N'.<br>
                                4. Information for patients page is generated and the patients page is rendered.<br>
                            </p>
                        </section>


                        <h4 class="section-title text-gradient">Filters</h4>
                        <p> *filter functionality for appointments and patients is implemented identically, for
                            simplicity's sake, this document will only discuss filtering appointments.</p>

                        <strong> Forms </strong>
                        <p> Filter functionality for the appointment page is implemented using a Django
                            form. This is <strong>NOT</strong> a model form. The form used is called
                            SearchAppointmentForm in forms.py.
                            It is a series of search bars with a single submit button.</p>

                        <pre class="text-left"><code class="language-python">
                            class SearchAppointmentForm(forms.Form):
                                appointment_ID = forms.CharField(
                                    label='Search by ID',
                                    max_length=100, required=False)
                                ...
                            </code></pre>
                        <strong>Processing Input</strong><br>
                        <p>
                            User inputs to the forms are used to filter objects using <code>processQuery()</code>
                            function.
                            Below is a section of code for filtering appointments.
                            The parameter dic is defined by <code>dic = form.cleaned_data</code>, it stored to inputs to
                            the form by the user.
                            For each value in dic, if it is not None then appointment objects are filtered to
                            find
                            the particular appointments that match the search request.
                            These appointments are sent to the appointments page to be displayed.
                        </p>
                        <pre class="text-left"><code class="language-python">
                            <span style="color:orange;">def </span><span style="color:blue">processQuery</span>(self, dic, appointments):
                                <span style="color:green;">appointment_ID</span> = dic['appointment_ID']
                                <span style="color:green;">PAS_number</span> = dic['PAS_number']
                                ...
                                <span style="color:red;">if </span><span style="color:green;">appointment_ID</span>:
                                    <span style="color:green;">appointments</span> = <span style="color:green;">appointments</span>.filter
                                        (appointment_ID=<span style="color:green;">appointment_ID</span>)
                                <span style="color:red;">if </span><span style="color:green;">PAS_number</span>:
                                    <span style="color:green;">appointments</span> = <span style="color:green;">appointments</span>.filter
                                        (PAS_number=<span style="color:green;">PAS_number</span>)
                                ...
                                return <span style="color:green">appointments</span>
                        </code>
                        </pre>
                    </div>
                </div>
            </div>
        </section>

    </main>
    <!-- Footer-->
    <footer class="border-top">
        <div class="container px-4 px-lg-5">
            <div class="row gx-4 gx-lg-5 justify-content-center">
                <div class="col-md-10 col-lg-8 col-xl-7">
                    <ul class="list-inline text-center">
                        <li class="list-inline-item">
                            <a href="https://twitter.com/uclcs?ref_src=twsrc%5Egoogle%7Ctwcamp%5Eserp%7Ctwgr%5Eauthor">
                                <span class="fa-stack fa-lg">
                                    <i class="fas fa-circle fa-stack-2x"></i>
                                    <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                        <li class="list-inline-item">
                            <a href="https://www.facebook.com/UCLCS.Home/">
                                <span class="fa-stack fa-lg">
                                    <i class="fas fa-circle fa-stack-2x"></i>
                                    <i class="fab fa-facebook-f fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                        <li class="list-inline-item">
                            <a href="https://github.com/ArslanAftab/ucl-ixn-team19">
                                <span class="fa-stack fa-lg">
                                    <i class="fas fa-circle fa-stack-2x"></i>
                                    <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                    </ul>
                    <div class="small text-center text-muted fst-italic">
                        <p>Copyright  2021 - 2022
                            <a href="!#">Moorfields Hospital</a>
                            ,
                            <a href="!#">Arslan Aftab</a>
                            ,
                            <a href="!#">Yue He</a>
                            ,
                            <a href="https://www.linkedin.com/in/kamil-ebanks/">Kamil Ebanks</a>
                            - All rights reserved.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </footer>
    <!-- Bootstrap core JS-->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Core theme JS-->
    <script src="js/scripts.js"></script>
</body>

</html>